# 雜記
* 第 9 週正常上課，第 10 週期中考
* 期中考考課本每章節後面的選擇題，轉換成簡答題的形式（約 20 ~ 25 題）

# C14 系統服務與排程
* 在 CentOS, readhat, fedora 環境下
    * http 伺服器稱作 `httpd`（apache）
    * 啟動伺服器指令：`systemctl start httpd`
* 而在 ubuntu 環境下
    * http 伺服器稱作 `apache`（apache2）
    * 啟動伺服器指令：`systemctl start apache2`
* 在 Docker 輕量化環境下，可能沒有 `systemctl` 之類的指令
    * 因此可以改採用 `/etc/init.d/apache2 start` 或 `/etc/init.d/ssh start` 等指令

## 14-1 服務管理
### 14-1-1, 14-1-2 init vs. systemd
* 傳統：init
    * 缺點：序列(Serial)式啟動，因此較花時間
* 現代：systemd
    * 優點：沒有相依性的程式能夠並發(concurrent)式啟動，因而加快開機速度
    * 具有彈性
* 這兩種服務管理系統的 process id 皆為 1
* `ps -aux | grep systemd`：查看 systemd 的行程狀態
* `pstree`：查看行程間的關聯性（樹狀結構），能看到 systemd 為樹狀的根
* 補充：在行程中，有一個服務稱作 dhclient，dhclient：dhcp 客戶端
    * dhclient + 介面卡名稱：要一個可能的 IP，以及相關的設定

### Unit（服務） vs. Target（標的）
* 每個服務都是一個 Unit
* 描述服務間的依賴性（如啟動服務時，是否要先啟動另一個服務才能執行；或服務關閉時，須執行甚麼動作）
* systemd 的主要目錄（相關檔案存放）在 `/usr/lib/systemd/system`

```bash
[user@pc1 system]$ cat /usr/lib/systemd/system/vsftpd.service
[Unit]
Description=Vsftpd ftp daemon # 描述, daemon:後台程序
After=network.target # 代表須先執行 network 此服務

[Service]
Type=forking
ExecStart=/usr/sbin/vsftpd /etc/vsftpd/vsftpd.conf # 執行服務的路徑

[Install]
WantedBy=multi-user.target
```

* 指令 `/usr/sbin/vsftpd /etc/vsftpd/vsftpd.conf` 等同於 `systemctl start vsftpd`，會將 vsftpd 服務開啟
    * 如果在完整的環境下，一般會建議採用 `systemctl` 指令

## 14-2 管理服務
### 服務種類
* `.service`
    * pros：較快，會在背景持續執行
    * cons：較吃資源，會佔用記憶體
* `.socket`
    * 當通訊埠有客戶端連線時才啟動的服務
    * pros：無客戶端需求時不會耗費系統資源
    * cons：速度相對較慢一點點

## 14-4 init 服務相關檔案
* 系統服務執行檔目錄：`/etc/init.d`
* 各個啟動層級的服務腳本目錄：`/etc/rcX.d`
    * `rc0.d` ~ `rc6.d` 分別對應 init 的 7 個 runlevel
* 開機啟動後會自動執行的腳本檔：`/etc/rc.local`
    * 嵌入式裝置（如 raspberry Pi, Arduino）中會採用

## 14-5 系統服務
```
ntsysv
```

## 14-6 chkconfig
* chkconfig：管理系統服務的自由軟體

## 14-8 系統排程
* `crond` 服務
* 可參考 [linux计划任务crontab视频教程-慕课网](https://www.imooc.com/learn/216)

---

* 老師認為今天的課程講得不夠詳細，因此可以參考影片
    * [介绍systemd功能-51CTO学院](http://edu.51cto.com/center/course/lesson/index?id=132551)

* 開機的流程：
    1. BIOS
    2. boot loader
    3. kernel
    4. systemd