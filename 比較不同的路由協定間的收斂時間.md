# 比較不同的路由協定間的收斂時間

- [比較不同的路由協定間的收斂時間](#%e6%af%94%e8%bc%83%e4%b8%8d%e5%90%8c%e7%9a%84%e8%b7%af%e7%94%b1%e5%8d%94%e5%ae%9a%e9%96%93%e7%9a%84%e6%94%b6%e6%96%82%e6%99%82%e9%96%93)
  - [環境設置：](#%e7%92%b0%e5%a2%83%e8%a8%ad%e7%bd%ae)
  - [結論](#%e7%b5%90%e8%ab%96)

## 環境設置：

```
/* 別忘記設定 VPC1, VPC2 的 Gateway */
// VPC1
VPCS> ip 192.168.10.1 255.255.255.0 192.168.10.254



// VPC2
VPCS> ip 192.168.20.1 255.255.255.0 192.168.20.254



// R1
Router>enable
Router#configure terminal
Router(config)#hostname R1
R1(config)#interface e0/0
R1(config-if)#ip addr 192.168.10.254 255.255.255.0
R1(config-if)#no shutdown
R1(config-if)#interface e0/1
R1(config-if)#ip addr 192.168.12.1 255.255.255.0
R1(config-if)#no shutdown
R1(config-if)#interface e0/2
R1(config-if)#ip addr 192.168.13.1 255.255.255.0
R1(config-if)#no shutdown



// R2
Router>enable
Router#configure terminal
Router(config)#hostname R2
R2(config)#interface e0/0
R2(config-if)#ip addr 192.168.20.254 255.255.255.0
R2(config-if)#no shutdown
R2(config-if)#interface e0/1
R2(config-if)#ip addr 192.168.12.2 255.255.255.0
R2(config-if)#no shutdown
R2(config-if)#interface e0/2
R2(config-if)#ip addr 192.168.23.2 255.255.255.0
R2(config-if)#no shutdown



// R3
Router>enable
Router#configure terminal
Router(config)#hostname R3
R3(config)#interface e0/0
R3(config-if)#ip addr 192.168.13.3 255.255.255.0
R3(config-if)#no shutdown
R3(config-if)#interface e0/1
R3(config-if)#ip addr 192.168.23.3 255.255.255.0
R3(config-if)#no shutdown
```

- ping 連接測試：

```
// VPC1
VPCS> ping 192.168.10.254

84 bytes from 192.168.10.254 icmp_seq=1 ttl=255 time=0.602 ms



// VPC2
VPCS> ping 192.168.20.254

84 bytes from 192.168.20.254 icmp_seq=1 ttl=255 time=0.435 ms
```

- 使用 RIP 協定測試，並斷開 R2 的 e0/1 介面

```
// R1
router rip
version 2
no auto-summary
network 192.168.10.0
network 192.168.12.0
network 192.168.13.0



// R2
router rip
version 2
no auto-summary
network 192.168.12.0
network 192.168.23.0
network 192.168.20.0



// R3
router rip
version 2
no auto-summary
network 192.168.13.0
network 192.168.23.0



// R1, R2, R3
do show ip route



// VPC1
trace 192.168.20.1
ping 192.168.20.1 -t // -t：持續 ping



// R2
// 將 R2 的 e0/1 斷線
interface e0/1
shutdown



// 查看 RIP 的收斂時間需要多久
VPCS> ping 192.168.20.1 -t

84 bytes from 192.168.20.1 icmp_seq=1 ttl=62 time=2.593 ms
84 bytes from 192.168.20.1 icmp_seq=2 ttl=62 time=1.119 ms
84 bytes from 192.168.20.1 icmp_seq=3 ttl=62 time=1.283 ms
84 bytes from 192.168.20.1 icmp_seq=4 ttl=62 time=1.110 ms
192.168.20.1 icmp_seq=5 timeout

<!-- output omitted -->

192.168.20.1 icmp_seq=126 timeout
*192.168.10.254 icmp_seq=127 ttl=255 time=0.831 ms (ICMP type:3, code:1, Destination host unreachable)
```

- 重新連接 R2 的 e0/1 介面，並取消 RIP 協定，改用 OSPF 協定

```
// R2
// 將 R2 的 e0/1 連線
interface e0/1
no shutdown



// R3
no router rip



// R1
router ospf 1 // 1 為 Process ID
network 192.168.10.0 0.0.0.255 area 0
network 192.168.12.0 0.0.0.255 area 0
network 192.168.13.0 0.0.0.255 area 0



// R2
router ospf 1 // 1 為 Process ID
network 192.168.12.0 0.0.0.255 area 0
network 192.168.20.0 0.0.0.255 area 0
network 192.168.23.0 0.0.0.255 area 0



// R3
router ospf 1 // 1 為 Process ID
network 192.168.13.0 0.0.0.255 area 0
network 192.168.23.0 0.0.0.255 area 0



// R1, R2, R3
do show ip route // 查看是否有學習到，並確認是否為 O (OSPF)



// VPC1
trace 192.168.20.1
ping 192.168.20.1 -t // -t：持續 ping



// R2
interface e0/1
shutdown

VPCS> ping 192.168.20.1 -t
<!-- output omitted -->
84 bytes from 192.168.20.1 icmp_seq=8 ttl=62 time=1.053 ms
192.168.20.1 icmp_seq=9 timeout
192.168.20.1 icmp_seq=10 timeout
192.168.20.1 icmp_seq=11 timeout
84 bytes from 192.168.20.1 icmp_seq=12 ttl=61 time=0.812 ms

// 查看 OSPF 的收斂時間需要多久
```

## 結論

- 收斂時間
  - RIPv2：約 120 秒
  - OSPF：約 4 ~ 5 秒